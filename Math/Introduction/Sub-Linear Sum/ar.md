# المجاميع دون خطية

## المقدمة  
في العديد من المسائل، نحتاج إلى حساب مجموع سلسلة في زمن ثابت $O(1)$ دون المرور بكل حد على حدة. تُسمى هذه الصيغ **المجاميع دون خطية** لأن زمن التنفيذ لا ينمو بشكل خطي مع $n$.

---

## مجموع أول $n$ عدد طبيعي  
$$
S_1(n) = 1 + 2 + \cdots + n = \frac{n(n+1)}{2}
$$  
**مخطط البرهان**: أزواج الحدود $(1,n)، (2,n-1)، \dots$؛ كل زوج مجموعه $n+1$، وهناك $n/2$ أزواج.  

=== "c++"

```cpp
// O(1)
long long sum_n(long long n) {
    return n * (n + 1) / 2;
}
```

---

## مجموع المربعات  
$$
S_2(n) = 1^2 + 2^2 + \cdots + n^2 = \frac{n(n+1)(2n+1)}{6}
$$  

=== "c++"

```cpp
// O(1)
long long sum_sq(long long n) {
    return n * (n + 1) * (2*n + 1) / 6;
}
```

---

## مجموع المكعبات  
$$
S_3(n) = 1^3 + 2^3 + \cdots + n^3 = \Bigl(\frac{n(n+1)}{2}\Bigr)^{2}
$$  

=== "c++"

```cpp
// O(1)
long long sum_cb(long long n) {
    long long t = n * (n + 1) / 2;
    return t * t;
}
```

---

## مجموع المتسلسلة الحسابية  
الحد الأول $a$، والفارق الثابت $d$، وعدد الحدود $k$:  
$$
S_{\rm AP} = a + (a+d) + \cdots + \bigl(a + (k-1)d\bigr)
= \frac{k\bigl(2a + (k-1)d\bigr)}{2}
$$  

=== "c++"

```cpp
// O(1)
long long sum_ap(long long a, long long d, long long k) {
    return k * (2*a + (k-1)*d) / 2;
}
```

---

## مجموع المتسلسلة الهندسية  
الحد الأول $a$، والنسبة $r \neq 1$، وعدد الحدود $k$:  
$$
S_{\rm GP}
= a + ar + ar^2 + \cdots + ar^{k-1}
= a \,\frac{r^k - 1}{r - 1}
$$  

=== "c++"

```cpp
// O(1) بشرط أن تكون دالة pow في $O(\log k)$
long long sum_gp(long long a, long long r, long long k) {
    return a * ((long long)(std::pow(r, k) - 1) / (r - 1));
}
```

---

## حالات خاصة  
- **مجموع أول $n$ أعداد فردية**  
  $$
    1 + 3 + 5 + \cdots + (2n-1) = n^2
  $$
- **مجموع أول $n$ أعداد زوجية**  
  $$
    2 + 4 + 6 + \cdots + 2n = n(n+1)
  $$

---

## ملاحظات حول تجاوز السعة (Overflow)  
بالنسبة لـ $n$ الكبير (مثلاً $n>10^9$)، قد تتجاوز النتائج الوسيطة حدود 64-بت. استخدم  
=== "c++"

```cpp
__int128
```  
في الحسابات المؤقتة، ثم حول النتيجة إلى `long long` إذا لزم الأمر.

---

## الخلاصة  
- جميع الصيغ السابقة تُنفَّذ في زمن ثابت $O(1)$.  
- مفيدة للغاية عند الحاجة لحساب المجاميع بشكل متكرر أو سريع جدًا.  
- احتفظ بالضرب قبل القسمة لتجنُّب أخطاء القطع في الحساب الصحيح.
