# الخريطة (Map)


#### ماب (`map`/`TreeMap`) وهاش-ماب (`unordered_map`/`HashMap`/`dict`)

في البرمجة التنافسية، غالبًا ما تحتاج إلى عدّ أو البحث عن عناصر مفاتيحها ليست أعدادًا صحيحة صغيرة (مثل السلاسل النصية، الأزواج، المعرفات المبعثرة). تفشل مصفوفة التكرار في تلك الحالات — استخدم الحاويات الترابطية بدلًا منها.

---

### الوصف

- **ماب<K,V> (في C++) / TreeMap<K,V> (في Java)**  
  - شجرة متوازنة تحت الغطاء (غالبًا شجرة أحمر-أسود).  
  - المفاتيح مخزنة بترتيب مرتب.  
- **هاش-ماب<K,V> (في C++) / HashMap<K,V> (في Java) / dict (في Python)**  
  - جدول تجزئة بعمليات متوسطة O(1).  
  - لا يضمن ترتيبًا معينًا.

---

### متى نستخدمها

| السيناريو                                   | مصفوفة التكرار | ماب / TreeMap        | هاش-ماب / HashMap / dict |
|---------------------------------------------|:-------------:|:--------------------:|:-----------------------:|
| المفاتيح أعداد صحيحة متجاورة وصغيرة        | ✓             | ✓ (لكن أبطأ)         | ✓ (يحتاج تجزئة)          |
| المفاتيح أعداد صحيحة كبيرة أو مبعثرة (حتى 10⁹) | ✗          | ✓                    | ✓                        |
| المفاتيح سلاسل نصية (كلمات، مقاطع)         | ✗             | ✓                    | ✓                        |
| المفاتيح أزواج/مجموعات (إحداثيات)         | ✗             | ✓                    | ✓                        |
| نحتاج ترتيبًا أو استعلامات مدى            | ✗             | ✓                    | ✗                        |

---

### التعقيد الزمني

| العملية           | ماب / TreeMap    | هاش-ماب / HashMap / dict     |
|:-----------------:|:----------------:|:-----------------------------:|
| **الإدراج**       | O(log n)         | O(1) متوسط، O(n) في أسوأ الحالات |
| **البحث/الوصول**  | O(log n)         | O(1) متوسط، O(n) في أسوأ الحالات |
| **الحذف**         | O(log n)         | O(1) متوسط، O(n) في أسوأ الحالات |
| **التكرار**       | O(n) بترتيب المفاتيح | O(n) بترتيب عشوائي       |

---

### أمثلة التنفيذ

=== c++

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
    int n;
    cin >> n;
    // عدّ التكرارات للمفاتيح العشوائية (مثل السلاسل النصية)
    unordered_map<string,int> freq;     // هاش-ماب: O(1) متوسط
    map<string,int>    ofreq;           // ماب: O(log n) ، مرتب

    for(int i = 0; i < n; i++) {
        string s;
        cin >> s;
        freq[s]++;    // هاش-ماب
        ofreq[s]++;   // ماب
    }

    // مثال على البحث والتكرار بالترتيب
    for (auto &p : ofreq) {
        // p.first = المفتاح، p.second = التكرار
        cout << p.first << " -> " << p.second << "\n";
    }

    cout << "التكرار لكلمة "foo": " << freq["foo"] << "\n";
    return 0;
}
```

=== Java

```java
import java.util.*;

public class MapDemo {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        int n = sc.nextInt();
        HashMap<String,Integer> hmap = new HashMap<>();   // هاش-ماب: O(1) متوسط
        TreeMap<String,Integer> omap = new TreeMap<>();   // ماب: O(log n)

        while (n-- > 0) {
            String s = sc.next();
            hmap.put(s, hmap.getOrDefault(s, 0) + 1);
            omap.put(s, omap.getOrDefault(s, 0) + 1);
        }

        // تكرار مرتب
        for (var e : omap.entrySet()) {
            System.out.println(e.getKey() + " -> " + e.getValue());
        }
        System.out.println("التكرار لكلمة "foo": " + hmap.getOrDefault("foo", 0));
    }
}
```

=== Python

```python
from collections import defaultdict

n = int(input())
hmap = defaultdict(int)   # dict كهاش-ماب مع قيمة افتراضية 0

for _ in range(n):
    s = input().strip()
    hmap[s] += 1          # هاش-ماب متوسطة O(1)

# التكرار بالترتيب إذا لزم الأمر:
for key in sorted(hmap):
    print(f"{key} -> {hmap[key]}")

print("التكرار لكلمة "foo":", hmap["foo"])
```

---

### لماذا ماب بدل مصفوفة التكرار؟

1. **أنواع مفاتيح غير محدودة**:  
   - **سلاسل نصية**: عدّ الكلمات أو المقاطع.  
   - **أزواج/مجموعات**: عدّ الإحداثيات أو حواف الرسم البياني.

2. **لا حاجة لنطاق مسبق**:  
   - مصفوفة التكرار تتطلب معرفة `max_key` وتخصيص `O(max_key)`.  
   - الماب تنمو ديناميكيًا بتعقيد `O(log n)` أو `O(1)`.

3. **بيانات مبعثرة**:  
   - إذا ظهرت بعض المفاتيح فقط من نطاق ضخم، فالمصفوفة تضيع مساحة كبيرة.

4. **عمليات مرتبة** (مع ماب/TreeMap):  
   - استعلامات المدى: `lower_bound`، `upper_bound`.  
   - التكرار بترتيب المفاتيح.

```cpp
// مثال: عدّ الحواف في رسم بياني
map<pair<int,int>,int> edgeCount;
edgeCount[{u,v}]++;      // لا حاجة لمصفوفة ضخمة
```

---

> **الخلاصة:**  
> - **مصفوفات التكرار** ممتازة للمفاتيح الصحيحة الصغيرة والمعروفة.  
> - **ماب/هاش-ماب** تتعامل بكفاءة مع **السلاسل**، **الأزواج**، **المعرفات المبعثرة أو غير المعروفة** بأقل تكلفة إضافية.  
